<!-- Add Navbar -->
<app-navbar></app-navbar>

<!-- Take Interviews Page Navigation Menu -->
<nav class="dashboard-nav">
  <div class="nav-container">
    <div class="nav-menu">
      <a class="nav-item" routerLink="/dashboard" routerLinkActive="active">
        <i class="fas fa-home"></i>
        <span>Dashboard</span>
      </a>
      
      <a class="nav-item" routerLink="/topics" routerLinkActive="active">
        <i class="fas fa-book"></i>
        <span>Learn topics</span>
      </a>
      
      <a class="nav-item" routerLink="/coding-round" routerLinkActive="active">
        <i class="fas fa-calendar-day"></i>
        <span>Solve daily challenge</span>
      </a>
      
      <a class="nav-item" routerLink="/progress" routerLinkActive="active">
        <i class="fas fa-chart-line"></i>
        <span>Track your progress</span>
      </a>
    </div>
  </div>
</nav>

<!-- Existing content -->
<div class="voice-interview-container">
  <div class="interview-card">
    <!-- Header Section -->
    <div class="interview-header">
      <div class="header-content">
        <h1>
          <i class="fas fa-microphone"></i>
          AI Voice Interview
        </h1>
        <p class="subtitle">Practice real interviews with voice interaction. Speak your answers and get intelligent feedback.</p>
      </div>
    </div>

    <div class="interview-content">
      <!-- Browser Support Check -->
      <div *ngIf="!isVoiceSupported()" class="browser-warning">
        <div class="warning-content">
          <i class="fas fa-exclamation-triangle"></i>
          <h3>Voice Features Not Supported</h3>
          <p>Your browser doesn't support speech recognition or synthesis. Please use Chrome, Edge, or Safari for the best experience.</p>
          <p class="browser-note">Recommended: Google Chrome (desktop) or Microsoft Edge</p>
        </div>
      </div>

      <!-- Domain Selection -->
      <div *ngIf="!isInterviewStarted && !isInterviewEnded && isVoiceSupported()" class="domain-selection">
        <div class="selection-content">
          <div class="voice-icon">
            <i class="fas fa-microphone-alt"></i>
          </div>
          <h2>Select Interview Domain</h2>
          <p class="description">
            Choose your interview focus area. The AI will ask relevant technical and behavioral questions.
          </p>

          <!-- Domain Selection -->
          <div class="domain-section">
            <label for="domainSelect" class="section-label">Interview Domain:</label>
            <select id="domainSelect" [(ngModel)]="selectedDomain" (change)="onDomainChange()" class="domain-select">
              <option *ngFor="let domain of domains" [value]="domain.id">
                {{ domain.name }}
              </option>
            </select>
          </div>

          <!-- Difficulty Selection -->
          <div class="difficulty-section">
            <label class="section-label">Difficulty Level:</label>
            <div class="difficulty-buttons">
              <button 
                class="difficulty-btn" 
                [class.active]="difficulty === 'easy'"
                (click)="difficulty = 'easy'">
                <i class="fas fa-star"></i> Easy
              </button>
              <button 
                class="difficulty-btn" 
                [class.active]="difficulty === 'medium'"
                (click)="difficulty = 'medium'">
                <i class="fas fa-star-half-alt"></i> Medium
              </button>
              <button 
                class="difficulty-btn" 
                [class.active]="difficulty === 'hard'"
                (click)="difficulty = 'hard'">
                <i class="fas fa-star"></i><i class="fas fa-star"></i> Hard
              </button>
            </div>
          </div>

          <!-- Domain Details -->
          <div *ngIf="currentDomain" class="domain-details">
            <div class="domain-info">
              <h4>{{ currentDomain.name }}</h4>
              <p>{{ currentDomain.description }}</p>
              
              <div class="skills-section">
                <div class="skills-column">
                  <h5><i class="fas fa-code"></i> Technical Skills</h5>
                  <ul>
                    <li *ngFor="let skill of getTechnicalSkills()">
                      {{ skill }}
                    </li>
                  </ul>
                </div>
                <div class="skills-column">
                  <h5><i class="fas fa-users"></i> Soft Skills</h5>
                  <ul>
                    <li *ngFor="let skill of getSoftSkills()">
                      {{ skill }}
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <button class="start-button" (click)="startInterview()" [disabled]="isLoading">
            <i class="fas fa-play"></i>
            {{ isLoading ? 'Starting...' : 'Start Voice Interview' }}
          </button>
        </div>
      </div>

      <!-- Voice Interview Interface -->
      <div *ngIf="isInterviewStarted && isVoiceSupported()" class="voice-interface">
        <div class="voice-header">
          <div class="voice-info">
            <h3>
              <i class="fas fa-microphone-alt"></i>
              {{ getDomainName(selectedDomain) }} Interview
            </h3>
            <span class="status-indicator">
              <i class="fas fa-circle" [class.recording]="isRecording" [class.thinking]="isAiSpeaking"></i>
              {{ isRecording ? 'Listening...' : isAiSpeaking ? 'AI Speaking...' : 'Ready' }}
            </span>
          </div>
          <button class="end-button" (click)="endInterview()" [disabled]="isRecording">
            <i class="fas fa-stop"></i>
            End Interview
          </button>
        </div>

        <!-- Audio Visualizer -->
        <div class="visualizer-container" *ngIf="isRecording">
          <canvas #audioVisualizer width="400" height="100" class="audio-visualizer"></canvas>
        </div>

        <!-- Messages Container -->
        <div class="messages-container" #messageContainer>
          <div *ngFor="let message of messages" 
               class="message" 
               [class.ai-message]="message.type === 'ai'" 
               [class.user-message]="message.type === 'user'">
            
            <div class="message-avatar">
              <i class="fas" [class]="message.type === 'ai' ? 'fa-robot' : 'fa-user'"></i>
            </div>
            
            <div class="message-content">
              <div class="message-text">{{ message.content }}</div>
              <div class="message-meta">
                <span class="message-time">{{ formatTime(message.timestamp) }}</span>
                <span *ngIf="message.isAudio" class="audio-indicator">
                  <i class="fas fa-volume-up"></i> Voice
                </span>
              </div>
            </div>
          </div>

          <!-- Loading indicator -->
          <div *ngIf="isLoading" class="message ai-message">
            <div class="message-avatar">
              <i class="fas fa-robot"></i>
            </div>
            <div class="message-content">
              <div class="typing-indicator">
                <span>AI is preparing your interview...</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Voice Controls -->
        <div class="voice-controls">
          <div class="controls-container">
            <button class="voice-button" 
                    [class.recording]="isRecording"
                    (click)="toggleRecording()"
                    [disabled]="isAiSpeaking || isInterviewEnded">
              <i class="fas" [class]="isRecording ? 'fa-stop-circle' : 'fa-microphone'"></i>
              {{ isRecording ? 'Stop Speaking' : 'Start Speaking' }}
            </button>
            
            <div class="voice-instructions">
              <p *ngIf="!isRecording && !isAiSpeaking">
                <i class="fas fa-info-circle"></i>
                Click the microphone button to speak your answer
              </p>
              <p *ngIf="isRecording" class="recording-instruction">
                <i class="fas fa-volume-up"></i>
                Speak now... I'm listening
              </p>
              <p *ngIf="isAiSpeaking" class="speaking-instruction">
                <i class="fas fa-robot"></i>
                AI is speaking... Please wait
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Interview Completed -->
      <div *ngIf="isInterviewEnded" class="interview-completed">
        <div class="completed-content">
          <div class="success-icon">
            <i class="fas fa-check-circle"></i>
          </div>
          <h2>Voice Interview Completed!</h2>
          <p>You've successfully completed the voice interview. Review your conversation and practice areas for improvement.</p>
          
          <div class="performance-stats">
            <div class="stat-item">
              <span class="stat-number">{{ userMessagesCount }}</span>
              <span class="stat-label">Questions Answered</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">{{ messages.length }}</span>
              <span class="stat-label">Total Interactions</span>
            </div>
            <div class="stat-item">
              <span class="stat-number">{{ getDomainName(selectedDomain) }}</span>
              <span class="stat-label">Domain</span>
            </div>
          </div>

          <div class="action-buttons">
            <button class="review-button" (click)="restartInterview()">
              <i class="fas fa-chart-bar"></i>
              Review Performance
            </button>
            <button class="restart-button" (click)="restartInterview()">
              <i class="fas fa-redo"></i>
              New Interview
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- frontend/src/app/components/topics/topic-test.component.html -->
<div class="container mt-4" *ngIf="!isLoading">
  <div class="row">
    <div class="col-12">
      <!-- Header -->
      <div class="card mb-4">
        <div class="card-header bg-primary text-white">
          <h4 class="mb-0">
            <i class="fas fa-code me-2"></i>{{ topic?.name }} - Coding Test
          </h4>
          <small>Problem {{ currentProblemIndex + 1 }} of {{ problems.length }}</small>
        </div>
        <div class="card-body">
          <h5 class="card-title">{{ currentProblem?.title }}</h5>
          <p class="card-text">{{ currentProblem?.description }}</p>
          <span class="badge" [ngClass]="{
            'bg-success': currentProblem?.difficulty === 'Easy',
            'bg-warning': currentProblem?.difficulty === 'Medium',
            'bg-danger': currentProblem?.difficulty === 'Hard'
          }">
            {{ currentProblem?.difficulty }}
          </span>
        </div>
      </div>

      <!-- Code Editor -->
      <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h6 class="mb-0">Code Editor</h6>
          <select class="form-select form-select-sm w-auto" [(ngModel)]="selectedLanguage" (change)="onLanguageChange()">
            <option value="python">Python</option>
            <option value="java">Java</option>
            <option value="javascript">JavaScript</option>
            <option value="cpp">C++</option>
          </select>
        </div>
        <div class="card-body p-0">
          <textarea class="form-control code-editor" [(ngModel)]="userCode" rows="15" 
                    placeholder="Write your code here..."></textarea>
        </div>
      </div>

      <!-- Actions -->
      <div class="d-flex justify-content-between mb-4">
        <div>
          <button class="btn btn-outline-primary me-2" (click)="previousProblem()" 
                  [disabled]="currentProblemIndex === 0">
            <i class="fas fa-arrow-left me-1"></i>Previous
          </button>
          <button class="btn btn-primary" (click)="nextProblem()" 
                  [disabled]="currentProblemIndex === problems.length - 1">
            Next <i class="fas fa-arrow-right ms-1"></i>
          </button>
        </div>
        <button class="btn btn-success" (click)="runTests()" [disabled]="isLoading">
          <i class="fas fa-play me-1"></i>
          {{ isLoading ? 'Running...' : 'Run Tests' }}
        </button>
      </div>

      <!-- Results -->
      <div class="card" *ngIf="testResults.length > 0">
        <div class="card-header">
          <h6 class="mb-0">Test Results</h6>
        </div>
        <div class="card-body">
          <div class="output-container">
            <pre>{{ output }}</pre>
          </div>

          <div class="mt-3">
            <div *ngFor="let result of testResults" class="mb-2 p-2 rounded" 
                 [ngClass]="{'bg-light': !result.passed, 'bg-success text-white': result.passed}">
              <strong>Test Case {{ result.testCase }}:</strong> 
              {{ result.passed ? '✅ PASSED' : '❌ FAILED' }}
              <div *ngIf="!result.passed" class="mt-1 small">
                <div><strong>Input:</strong> {{ result.input }}</div>
                <div><strong>Expected:</strong> {{ result.expected }}</div>
                <div><strong>Your Output:</strong> {{ result.output }}</div>
              </div>
            </div>
          </div>

          <div class="progress mt-3" *ngIf="testResults.length > 0">
            <div class="progress-bar" [ngClass]="{'bg-success': isSolved, 'bg-warning': !isSolved}" 
                 [style.width]="(getPassedCount() / getTotalTestCases()) * 100 + '%'">
              {{ getPassedCount() }}/{{ getTotalTestCases() }} tests passed
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div *ngIf="isLoading" class="text-center py-5">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
  <p class="mt-3">Loading test problems...</p>
</div>
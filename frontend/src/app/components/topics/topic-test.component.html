<app-navbar></app-navbar>

<nav class="dashboard-nav">
  <div class="nav-container">
    <div class="nav-menu">
      <a class="nav-item" routerLink="/dashboard" routerLinkActive="active">
        <i class="fas fa-home"></i>
        <span>Dashboard</span>
      </a>
      <a class="nav-item" routerLink="/topics" routerLinkActive="active">
        <i class="fas fa-book"></i>
        <span>Topics</span>
      </a>
      <a class="nav-item" routerLink="/voice-interview" routerLinkActive="active">
        <i class="fas fa-microphone"></i>
        <span>Interviews</span>
      </a>
      <a class="nav-item" routerLink="/progress" routerLinkActive="active">
        <i class="fas fa-chart-line"></i>
        <span>Progress</span>
      </a>
    </div>
  </div>
</nav>

<div class="test-container" *ngIf="!isLoading">
  <div class="test-header">
    <div class="header-content">
      <h1>{{ topic?.name }} - Knowledge Test</h1>
      <p>Test your understanding with 25 questions. Earn 2 points for each correct answer.</p>
    </div>
    <div class="test-info">
      <div class="info-card">
        <i class="fas fa-question-circle"></i>
        <span>Question {{ currentQuestionIndex + 1 }} of {{ totalQuestions }}</span>
      </div>
      <div class="info-card">
        <i class="fas fa-star"></i>
        <span>Score: {{ score }} points</span>
      </div>
    </div>
  </div>

  <div class="progress-section">
    <div class="progress-header">
      <span>Test Progress</span>
      <span>{{ getProgressPercentage().toFixed(0) }}%</span>
    </div>
    <div class="progress-bar">
      <div class="progress-fill" [style.width]="getProgressPercentage() + '%'"></div>
    </div>
  </div>

  <div class="test-content" *ngIf="!testCompleted && questions.length > 0">
    <div class="question-card">
      <div class="question-header">
        <h3>{{ getCurrentQuestion().question }}</h3>
        <span class="question-type">{{ getCurrentQuestion().type === 'mcq' ? 'Multiple Choice' : 'Fill in the Blank' }}</span>
      </div>

      <div *ngIf="getCurrentQuestion().type === 'mcq'" class="options-container">
        <div *ngFor="let option of getCurrentQuestion().options; let i = index" 
             class="option-card"
             [class.correct]="getCurrentQuestion().isAnswered && option === getCurrentQuestion().correctAnswer"
             [class.incorrect]="getCurrentQuestion().isAnswered && option === getCurrentQuestion().userAnswer && option !== getCurrentQuestion().correctAnswer"
             [class.disabled]="getCurrentQuestion().isAnswered"
             (click)="selectAnswer(currentQuestionIndex, option)">
          
          <div class="option-content">
            <div class="option-letter">{{ String.fromCharCode(65 + i) }}</div>
            <div class="option-text">{{ option }}</div>
          </div>
          
          <div class="option-feedback" *ngIf="getCurrentQuestion().isAnswered">
            <div *ngIf="option === getCurrentQuestion().correctAnswer" class="correct-feedback">
              <i class="fas fa-check"></i> Correct! +2 points
            </div>
            <div *ngIf="option === getCurrentQuestion().userAnswer && option !== getCurrentQuestion().correctAnswer" 
                  class="incorrect-feedback">
              <i class="fas fa-times"></i> Wrong answer
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="getCurrentQuestion().type === 'fillblank'" class="fillblank-section">
        <div class="fillblank-input">
          <input type="text" 
                 #answerInput
                 [disabled]="getCurrentQuestion().isAnswered"
                 placeholder="Type your answer here..."
                 (keyup.enter)="submitFillBlankAnswer(answerInput)"
                 class="form-control">
          <button class="submit-btn" 
                  [disabled]="getCurrentQuestion().isAnswered"
                  (click)="submitFillBlankAnswer(answerInput)">
            Submit
          </button>
        </div>
        
        <div class="fillblank-feedback" *ngIf="getCurrentQuestion().isAnswered">
          <div *ngIf="getCurrentQuestion().isCorrect" class="correct-feedback">
            <i class="fas fa-check"></i> Correct! +2 points
          </div>
          <div *ngIf="!getCurrentQuestion().isCorrect" class="incorrect-feedback">
            <i class="fas fa-times"></i> Correct answer: "{{ getCurrentQuestion().correctAnswer }}"
          </div>
        </div>
      </div>
    </div>

    <div class="navigation-buttons">
      <button class="btn btn-outline" (click)="previousQuestion()" [disabled]="currentQuestionIndex === 0">
        <i class="fas fa-arrow-left"></i> Previous
      </button>
      
      <div class="navigation-center">
        <button *ngIf="!isLastQuestion() && !getCurrentQuestion().isAnswered" class="btn btn-primary" disabled>
          Select an answer to continue
        </button>
        
        <button *ngIf="!isLastQuestion() && getCurrentQuestion().isAnswered" class="btn btn-primary" (click)="nextQuestion()">
          Next Question <i class="fas fa-arrow-right"></i>
        </button>
        
        <button *ngIf="isLastQuestion() && getCurrentQuestion().isAnswered" class="btn btn-success" (click)="completeTest()">
          Complete Test <i class="fas fa-check"></i>
        </button>
      </div>
      
      <button class="btn btn-outline" (click)="backToTopics()">
        <i class="fas fa-times"></i> Exit Test
      </button>
    </div>
  </div>

  <div *ngIf="testCompleted" class="results-container">
    <div class="results-card">
      <div class="results-header">
        <div class="trophy-icon">
          <i class="fas fa-trophy"></i>
        </div>
        <h2>Test Completed!</h2>
        <p>You've completed the {{ topic?.name }} test</p>
      </div>
      
      <div class="results-stats">
        <div class="stat-item">
          <div class="stat-value">{{ totalScore }}</div>
          <div class="stat-label">Total Points</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">{{ getCorrectAnswersCount() }}/{{ totalQuestions }}</div>
          <div class="stat-label">Correct Answers</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">{{ getAccuracy() }}%</div>
          <div class="stat-label">Accuracy</div>
        </div>
      </div>

      <div class="results-actions">
        <button class="btn btn-outline" (click)="backToTopics()">
          <i class="fas fa-book"></i> Back to Topics
        </button>
        <button class="btn btn-primary" (click)="retryTest()">
          <i class="fas fa-redo"></i> Try Again
        </button>
      </div>
    </div>
  </div>
</div>

<div *ngIf="isLoading" class="loading-container">
  <div class="spinner"></div>
  <p>Loading test questions...</p>
</div>